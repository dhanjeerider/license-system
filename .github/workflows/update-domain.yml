name: Add Domain

on:
  repository_dispatch:
    types: [add-domain]

jobs:
  add:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Update JSON
      run: |
        DOMAIN="${{ github.event.client_payload.domain }}"
        FILE="domains/list.json"

        node <<EOF
        const fs = require("fs");
        const f = "domains/list.json";
        const d = JSON.parse(fs.readFileSync(f));
        const domain = process.env.DOMAIN;

        if (!d.pending.includes(domain) && !d.active.includes(domain)) {
          d.pending.push(domain);
        }

        fs.writeFileSync(f, JSON.stringify(d, null, 2));
        console.log("âœ… Added:", domain);
        EOF

    - name: Commit
      run: |
        git config user.name "Auto Bot"
        git config user.email "bot@github.com"
        git add .
        git commit -m "Added domain"
        git push
