<!DOCTYPE html>
<html>
<head>
<title>Dhanjee Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Poppins;background:#0f172a;color:white;padding:20px;}
.panel{
  background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);
  padding:20px;border-radius:14px;max-width:900px;margin:auto;
}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:12px;background:rgba(255,255,255,0.06);}
th{background:#3b82f6;}
button{padding:6px 12px;border:none;border-radius:8px;color:white;font-weight:500;}
.activate{background:#22c55e;}
.delete{background:#ef4444;}
.pending{background:rgba(255,255,0,0.15);}
.active{background:rgba(34,197,94,0.15);}
</style>
</head>

<body>

<div class="panel">
<h2 style="text-align:center;">Admin Dashboard - Dhanjee License</h2>

<table>
<thead>
<tr>
  <th>Domain</th>
  <th>Status</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>
</div>

<script>
async function load(){
  const url = "https://raw.githubusercontent.com/dhanjeerider/license-system/main/domains/list.json";
  let res = await fetch(url);
  let data = await res.json();

  let html = "";

  data.pending.forEach(d=>{
    html += `
    <tr class="pending">
      <td>${d}</td>
      <td>Pending</td>
      <td>
        <button class="activate" onclick="activate('${d}')">Activate</button>
        <button class="delete" onclick="del('${d}')">Delete</button>
      </td>
    </tr>`;
  });

  data.active.forEach(d=>{
    html += `
    <tr class="active">
      <td>${d}</td>
      <td>Active</td>
      <td><button class="delete" onclick="del('${d}')">Delete</button></td>
    </tr>`;
  });

  document.getElementById("tbl").innerHTML = html;
}

async function call(type, domain){
  await fetch("https://api.github.com/repos/dhanjeerider/license-system/dispatches",{
    method:"POST",
    headers:{
      "Accept":"application/vnd.github+json",
      "Authorization":"token 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"
    },
    body:JSON.stringify({
      event_type:type,
      client_payload:{ domain }
    })
  });
}

async function activate(d){ await call("activate-domain", d); load(); }
async function del(d){ await call("delete-domain", d); load(); }

load();
</script>

</body>
</html>
